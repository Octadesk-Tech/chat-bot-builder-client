const TIMEOUT = 5000 // 5 segundos

const sendWithTimeout = <T>(request: any>): Promise<any> => {
  let timeoutId: NodeJS.Timeout

  const timeoutPromise: Promise<T> = new Promise((_, reject) => {
    timeoutId = setTimeout(() => {
      reject(new Error('A requisição excedeu o tempo limite.'))
    }, TIMEOUT)
  })

  const requestPromise = request()

  return Promise.race([requestPromise, timeoutPromise])
    .then((result) => {
      clearTimeout(timeoutId)
      return result
    })
    .catch((error) => {
      clearTimeout(timeoutId)
      throw error
    })
}
